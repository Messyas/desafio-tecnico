<section class="products-table">
  @if (isLoading) {
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  }

  <div class="products-table__content">
    @if (products.length > 0) {
      <div class="products-table__scroll">
        <table mat-table [dataSource]="products" class="products-table__table">
          <ng-container matColumnDef="nome">
            <th mat-header-cell *matHeaderCellDef>Nome</th>
            <td mat-cell *matCellDef="let product">{{ product.nome }}</td>
          </ng-container>

          <ng-container matColumnDef="marca">
            <th mat-header-cell *matHeaderCellDef>Marca</th>
            <td mat-cell *matCellDef="let product">{{ product.marca }}</td>
          </ng-container>

          <ng-container matColumnDef="valor">
            <th mat-header-cell *matHeaderCellDef>Valor</th>
            <td mat-cell *matCellDef="let product">
              {{ product.valor | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR' }}
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Acoes</th>
            <td mat-cell *matCellDef="let product" class="products-table__actions-cell">
              <div class="products-table__actions">
                <button
                  mat-stroked-button
                  type="button"
                  [attr.data-testid]="'edit-product-' + product.id"
                  [disabled]="deletingProductId !== null"
                  (click)="onEdit(product)"
                >
                  Editar
                </button>
                <button
                  mat-stroked-button
                  type="button"
                  color="warn"
                  [attr.data-testid]="'delete-product-' + product.id"
                  [disabled]="isDeleteDisabled(product.id)"
                  (click)="onDelete(product)"
                >
                  @if (isDeleting(product.id)) {
                    Excluindo...
                  } @else {
                    Excluir
                  }
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
    } @else if (!isLoading) {
      <div class="products-table__empty">
        <p>Nenhum produto cadastrado.</p>
      </div>
    }
  </div>

  <mat-paginator
    class="products-table__paginator"
    [length]="totalCount"
    [pageIndex]="pageIndex"
    [pageSize]="limit"
    [pageSizeOptions]="pageSizeOptions"
    [disabled]="disablePagination"
    [showFirstLastButtons]="true"
    aria-label="Paginacao de produtos"
    (page)="onPageChanged($event)"
  />
</section>
